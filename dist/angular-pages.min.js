var app=angular.module("angular-pages",[]);
app.directive("znPagesPage",["znPageManager","Commons",function(a,c){function b(){var b,d;3===arguments.length?(b=arguments[1],d=arguments[2]):(b=arguments[0],d=arguments[1]);var f=d.id||void 0,h=d.znPagesContainerId||void 0,e=d.znPagesCollectionId||void 0,m="undefined"!==typeof d.ngInclude;if(void 0!==h&&void 0!==e&&(h=a.container(h),e=h.collection(e),void 0!==h&&void 0!==e)){f?h=e.page(f):(h=e.newPage(),f=h.getId());if(h.isReady())return h;h.attr({compiles:h.attr("compiles")+1,isNgInclude:m,parent:e});
b.attr("id",f);d.id=f;return h}}function g(b,d,f){f=b.page;var h=f.getId(),e=d[0].offsetWidth;d=d[0].offsetHeight;f.isReady()||(f.attr({width:e,height:d,ready:!0}),b.$emit("znPagesPageReady",{id:h}))}return{restrict:"A",scope:!0,compile:function(a,d){var f=a[0].tagName.toLowerCase();if("li"!==f)c.log(1,"LI, not "+f+", must be used for collections.");else{var h=b(a,d),e=h.getId();return function(d,f,a){h.isReady()||(d.page=h,d.name=e,h.attr("compiles"),h.attr("ngInclude")?d.$on("$includeContentLoaded",
function(h){h.targetScope.name===e&&(b(d,f,a),g(d,f,a))}):g(d,f,a))}}}}}]);
app.directive("znPagesCollection",["$compile","znPageManager","Commons",function(a,c,b){function g(){var d,b,e,m;3===arguments.length?(d=arguments[0],b=arguments[1],e=arguments[2],m="link"):(b=arguments[0],e=arguments[1],m="compile");var k="col"===e.znPagesLayout?e.znPagesLayout:"row",t=e.id||void 0,u=e.znPagesContainerId||void 0,g="undefined"!==typeof e.znPagesStart?Math.max(0,parseInt(e.znPagesStart)):0,v="undefined"!==typeof e.ngInclude,r,p,l,n=!1;if(void 0!==u){p=c.container(u);t?r=p.collection(t):
(r=p.newCollection(),t=r.getId(),b.addClass("zn-pages-"+k));if(r.isReady())return r;e.id=t;e["zn-pages-layout"]=k;e["zn-pages-start"]=g;b.attr({id:t,"zn-pages-layout":k,"zn-pages-start":g});b.removeClass("zn-animate").addClass("zn-noanimate");e=b.children();e=angular.element(e[0]);var q=e.attr("ng-repeat");void 0!==q&&(l=q.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),n=l[1],q=l[4],l=l[2],e.attr("ng-repeat",n+" in znPagesBuffer track by "+q),n=!0);r.attr({compiles:r.attr("compiles")+
1,layout:k,startIndex:g,activeIndex:g,parent:p,dynamic:n,ngInclude:v,collectionName:l});if(!l)for(e=b.children(),b=e.length,k=0;k<b;k++)g=e[k],angular.element(g).attr({"zn-pages-page":"","zn-pages-collection-id":t,"zn-pages-container-id":u}),"link"===m&&a(g)(d);return r}}function l(d,a,e){e=a[0].offsetWidth;var m=a[0].offsetHeight,k=d.collection,c=k.getId();k.attr("layout");k.attr("compiles");k.isReady()||(k.attr({width:e,height:m}),k.isDynamic()?(k.updateBuffer(d.$eval(k.attr("collectionName"))),
d.znPagesBuffer=k.getBuffer()):k.updateBuffer(),d.$watch("collection.hasMoved()",function(d){void 0!==d&&(d=!k.attr("restart"),b.slideTo(a,k,d),k.updateBuffer(),k.attr("restart",!1))}),k.attr("ready",!0),d.$emit("znPagesCollectionReady",{id:c}))}function d(d){d=d.attr("pages");for(var b=d.length,a=!0,m=0;m<b;m++)a=a&&d[m].isReady();return a}return{restrict:"A",scope:!0,compile:function(f,a){var c=f[0].tagName.toLowerCase();if("ul"!==c)b.log(1,"UL, not "+c+", must be used for collections.");else{var m=
g(f,a),k=m.getId();return function(f,a,c){if(!m.isReady()){f.collection=m;f.name=k;m.attr("layout");var h=m.isDynamic(),e=m.attr("ngInclude"),p=m.attr("compiles"),s=m.attr("collectionName");h||f.$on("znPagesPageReady",function(b){d(m)&&l(f,a,c)});h&&(1===p&&f.$watch(s,function(d,c){void 0==d||angular.equals(d,c)||(m.updateBuffer(d),f.znPagesBuffer=m.getBuffer(),0!==m.width&&0!==m.height||m.attr({width:a[0].offsetWidth,height:a[0].offsetHeight}),b.slideTo(a,m,!1))},!0),l(f,a,c));e?1===p&&f.$on("$includeContentLoaded",
function(d){d.targetScope.name===k&&g(f,a,c)}):d(m)?l(f,a,c):g(f,a,c);1===p&&a[0].addEventListener(b.whichTransitionEvent(),function(d){d.target.getAttribute("id").match(/^zn-pages-collection/)&&f.$apply(function(){var d=f.collection;d.attr("numMoved");if(d.isDynamic()){var c=d.getBuffer();d.attr("activeBufferIndex");angular.equals(c,f.znPagesBuffer)||(f.znPagesBuffer=c,b.slideTo(a,d,!1))}})},!1)}}}}}}]);
app.directive("znPages",["$window","$document","$compile","znSwipe","znPageManager","Commons",function(a,c,b,g,l,d){function f(){var d,f,a,c;3===arguments.length?(d=arguments[0],f=arguments[1],a=arguments[2],c="link"):(f=arguments[0],a=arguments[1],c="compile");var h="col"===a.znPages?a.znPages:"row",e=a.id||void 0,g="undefined"!==typeof a.znPagesStart?Math.max(0,parseInt(a.znPagesStart)):0,p="undefined"!==typeof a.znPagesSwipe,s="undefined"!==typeof a.ngInclude,n;e?n=l.container(e):(n=l.newContainer(),
e=n.getId(),f.addClass("zn-pages-"+h));if(n.isReady())return n;n.attr({compiles:n.attr("compiles")+1,startIndex:g,layout:h,isSwipe:p,ngInclude:s});a.id=e;a["zn-pages-layout"]=h;a["zn-pages-start"]=g;f.attr({id:e,"zn-pages-layout":h,"zn-pages-start":g});f=f.children();a=f.length;for(g=0;g<a;g++)p=angular.element(f[g]),s=p.attr("zn-pages-start")?parseInt(p.attr("zn-pages-start")):0,p.attr({"zn-pages-collection":"","zn-pages-container-id":e,"zn-pages-layout":h,"zn-pages-start":s}),p.addClass("zn-pages-"+
h),"link"===c&&b(p)(d);return n}function h(f,b,h){var e=f.container;h=e.getId();var l=b.children(),v=b[0].offsetWidth,r=b[0].offsetHeight,p=e.attr("layout"),s=e.attr("isSwipe");e.attr("compiles");if(!e.isReady()){e.attr({width:v,height:r});e.updateBuffer();f.$watch("container.hasMoved()",function(f,a){if(void 0!=f&&f!==a){var c=!e.attr("restart");d.slideTo(b,e,c);e.updateBuffer();e.attr("restart",!1)}});if(s){var n,q;g.bind(b,{start:function(d){n=d;q=void 0},move:function(f){if(n){if(void 0===q){var a=
Math.abs(f.x-n.x),c=Math.abs(f.y-n.y);q=a>c}var h;q?(c=f.x-n.x,"col"===p?(f=b,a=e):(a=e.attr("collections")[e.attr("activeIndex")],f=angular.element(l[e.attr("activeIndex")])),h=a.isHead()&&0<c||a.isTail()&&0>c?3:1,a=a.getPosition(a.attr("activeBufferIndex")).width+Math.round(c/h),d.slideX(f,a,!1)):(c=f.y-n.y,"col"===p?(a=e.attr("collections")[e.attr("activeIndex")],f=angular.element(l[e.attr("activeIndex")])):(f=b,a=e),h=a.isHead()&&0<c||a.isTail()&&0>c?3:1,a=a.getPosition(a.attr("activeBufferIndex")).height+
Math.round(c/h),d.slideY(f,a,!1))}},end:function(a){n&&void 0!=q&&(f.$apply(function(){var b=null,c=0,e=!1,h=f.container;q?(b="col"===p?h:h.attr("collections")[h.attr("activeIndex")],c=a.x-n.x,e=Math.abs(c)>=0.1*b.attr("width"),b.isHead()&&0<c||b.isTail()&&0>c||!e?(c=angular.element(l[h.attr("activeIndex")]),d.slideX(c,0,!0),b.slideReset()):0<c?h.slideRight():h.slideLeft()):(b="col"===p?h.attr("collections")[h.attr("activeIndex")]:h,c=a.y-n.y,e=Math.abs(c)>=0.1*b.attr("height"),b.isHead()&&0<c||b.isTail()&&
0>c||!e?b.slideReset():0>c?h.slideUp():h.slideDown())}),n=null)},cancel:function(){}})}a.onresize=function(){f.$apply(function(){e.attr({width:b[0].offsetWidth,height:b[0].offsetHeight});e.slideReset()})};c.ready(function(){f.$apply(function(){e.attr({width:b[0].offsetWidth,height:b[0].offsetHeight});e.slideHome()})});e.attr("ready",!0);f.$emit("znPagesContainerReady",{id:h})}}function e(d){d=d.attr("collections");for(var f=d.length,a=!0,b=0;b<f;b++)a=a&&d[b].isReady();return a}return{restrict:"A",
scope:!0,compile:function(a,b){var c=a[0].tagName.toLowerCase();if("div"!==c)d.log(1,"DIV, not "+c+", must be used for containers.");else{var g=f(a,b),l=g.getId();return function(d,a,b){if(!g.isReady()){d.container=g;d.name=l;"zn-pages-wrapper"!==a.parent()[0].id&&a.wrap('<div id="zn-pages-wrapper" class="zn-pages-container"></div>');var c=g.attr("ngInclude"),m=g.attr("compiles");g.attr("collections");1===m&&d.$on("znPagesCollectionReady",function(f){e(g)&&h(d,a,b)});c?1===m&&d.$on("$includeContentLoaded",
function(c){c.targetScope.name===l&&f(d,a,b)}):e(g)?h(d,a,b):f(d,a,b)}}}}}}]);
app.service("znPageManager",["Commons",function(a){function c(d,a){angular.extend(this,{id:d,width:0,height:0,parent:null,ready:!1,compiles:0})}function b(d){d={id:d,pages:[],activeIndex:0,buffer:[],bufferSize:3,activeBufferIndex:0,parent:null,dynamic:!1,collection:null,numMoved:0,moved:0,height:0,width:0,layout:"row",restart:!1,ready:!1,startIndex:0,compiles:0};for(var a in d)this[a]=d[a]}function g(d){angular.extend(this,{id:d,collections:[],activeIndex:0,activeBufferIndex:0,numMoved:0,moved:0,
height:0,width:0,layout:"row",isSwipe:!0,startIndex:0,restart:!1,ready:!1,compiles:0})}var l=[];c.prototype.attr=a.attr;c.prototype.toString=a.toString;c.prototype.getId=function(){return"zn-pages-page-"+this.id};c.prototype.isReady=function(){return this.ready};b.prototype.attr=a.attr;b.prototype.toString=a.toString;b.prototype.newPage=function(){var d=new c(this.id+"-"+this.pages.length);this.pages.push(d);return d};b.prototype.getId=function(){return"zn-pages-collection-"+this.id};b.prototype.page=
function(d){for(var a=0;a<this.pages.length;a++)if(this.pages[a].getId()===d)return this.pages[a]};b.prototype.isDynamic=function(){return this.dynamic};b.prototype.isReady=function(){for(var d=this.pages.length,a=this.ready,b=0;b<d;b++)a=a&&this.pages[b].isReady();return a};b.prototype.isHead=function(){return 0===this.activeIndex};b.prototype.isTail=function(){return this.activeIndex===this.length()-1};b.prototype.getBuffer=function(){return this.buffer};b.prototype.bufferLength=function(){return this.isDynamic()?
this.buffer.length:this.pages.length};b.prototype.length=function(){return this.isDynamic()?this.collection.length:this.pages.length};b.prototype.getPosition=function(a){var b={width:0,height:0},c=this.parent.attr("width"),e=this.parent.attr("height");b.width=-c*a;b.height=-e*a;return b};b.prototype.hasMoved=function(){return this.moved};b.prototype.slideReset=function(){this.moved++};b.prototype.slidePrev=function(){this.numMoved=-1;this.moved++};b.prototype.slideNext=function(){this.numMoved=1;
this.moved++};b.prototype.slideHome=function(){this.numMoved=0;this.activeBufferIndex=this.activeIndex=this.startIndex;this.restart=!0;this.updateBuffer();this.moved++};b.prototype.updateBuffer=function(a){if(this.isDynamic()){if(a&&(this.collection=a),void 0!==this.collection){a=[];var b,c=[],e;if(angular.isArray(this.collection))a=this.collection;else{for(b in this.collection)this.collection.hasOwnProperty(b)&&"$"!=b.charAt(0)&&a.push(b);a.sort()}if(angular.isArray(this.buffer))c=this.buffer;else{for(b in this.buffer)this.buffer.hasOwnProperty(b)&&
"$"!=b.charAt(0)&&c.push(b);c.sort()}if(0===this.buffer.length||!0==this.reset)k=this.startIndex;else if(a[this.activeIndex]!==c[this.activeBufferIndex]){for(var g=0;g<a.length;g++)a[g]===c[this.activeBufferIndex]&&(k=g);void 0===k&&(k=this.startIndex)}else k=this.activeIndex;k=Math.max(0,Math.min(k+this.numMoved,a.length-1));b=Math.max(0,Math.min(k-1,a.length-1));e=k-b;c=a.slice(b,b+this.bufferSize);if(angular.isArray(this.collection))this.buffer=c;else for(this.buffer={},g=0;g<c.length;g++)b=c[g],
this.buffer[b]=this.collection[b];this.activeBufferIndex=e;this.activeIndex=k;this.numMoved=0;return this.buffer}}else{var k=Math.max(0,Math.min(this.activeIndex+this.numMoved,this.pages.length-1));this.activeBufferIndex=this.activeIndex=k}};g.prototype.attr=a.attr;g.prototype.toString=a.toString;g.prototype.newCollection=function(){var a=new b(this.id+"-"+this.collections.length);this.collections.push(a);return a};g.prototype.getId=function(){return"zn-pages-container-"+this.id};g.prototype.isReady=
function(){for(var a=this.collections.length,b=this.ready,c=0;c<a;c++)b=b&&this.collections[c].isReady();return b};g.prototype.isHead=function(){return 0===this.activeIndex};g.prototype.isTail=function(){return this.activeIndex===this.length()-1};g.prototype.isLeft=function(){return"row"===this.layout?this.collections[this.activeIndex].isHead():this.isHead()};g.prototype.isRight=function(){return"row"===this.layout?this.collections[this.activeIndex].isTail():this.isTail()};g.prototype.isTop=function(){return"row"===
this.layout?this.isHead():this.collections[this.activeIndex].isHead()};g.prototype.isBottom=function(){return"row"===this.layout?this.isTail():this.collections[this.activeIndex].isTail()};g.prototype.length=function(){return this.collections.length};g.prototype.collection=function(a){for(var b=0;b<this.collections.length;b++)if(this.collections[b].getId()===a)return this.collections[b]};g.prototype.bufferLength=function(){return this.length()};g.prototype.hasMoved=function(){return this.moved};g.prototype.getPosition=
function(a){var b={width:0,height:0};b.width=-this.width*a;b.height=-this.height*a;return b};g.prototype.slideReset=function(){this.moved++};g.prototype.slideHome=function(){this.numMoved=0;this.activeBufferIndex=this.activeIndex=this.startIndex;this.restart=!0;this.updateBuffer();for(var a=0;a<this.length();a++)this.collections[a].slideHome();this.moved++};g.prototype.slidePrev=function(){this.numMoved=-1;this.moved++};g.prototype.slideNext=function(){this.numMoved=1;this.moved++};g.prototype.updateBuffer=
function(){var a=Math.max(0,Math.min(this.activeIndex+this.numMoved,this.collections.length-1));this.activeBufferIndex=this.activeIndex=a};g.prototype.slideLeft=function(){"col"===this.layout?this.slideNext():this.collections[this.activeIndex].slideNext()};g.prototype.slideRight=function(){"col"===this.layout?this.slidePrev():this.collections[this.activeIndex].slidePrev()};g.prototype.slideUp=function(){"col"===this.layout?this.collections[this.activeIndex].slideNext():this.slideNext()};g.prototype.slideDown=
function(){"col"===this.layout?this.collections[this.activeIndex].slidePrev():this.slidePrev()};g.prototype.initialize=function(a){this.attr(a);this.activeBufferIndex=this.activeIndex=a=Math.max(0,Math.min(this.activeIndex+this.numMoved,this.collections.length-1))};return{newContainer:function(){var a=new g(l.length);l.push(a);return a},containers:function(){return l},container:function(a){for(var b=0;b<l.length;b++)if(l[b].getId()===a)return l[b]}}}]);
app.factory("Commons",[function(){return{log:function(){var a=parseInt(arguments[0]);if(1===a||2===a||3===a)for(console.log(new Date),a=1;a<arguments.length;a++)console.log(arguments[a])},attr:function(a,c){if(angular.isObject(a))for(var b in a)a.hasOwnProperty(b)&&this.attr(b,a[b]);else if(void 0!==a&&void 0!==c)this[a]=c;else if(void 0!==a)return(this.getId().match(/^zn-pages-collection/)&&!this.isDynamic()||this.getId().match(/^zn-pages-container/))&&"activeBufferIndex"===a?this.activeIndex:"activeIndex"===
a?this.getId().match(/^zn-pages-container/)?Math.max(0,Math.min(this.activeIndex,this.collections.length)):this.getId().match(/^zn-pages-conllection/)?Math.max(0,Math.min(this.activeIndex,this.pages.length)):this.activeIndex:this[a]},toString:function(){var a="id: "+this.getId()+"\n",c;for(c in this){var b=typeof this[c];"function"!==b&&(a+=c+" ("+b+"): "+(null!==this[c]?this[c].toString():"null")+"\n")}return a},slideTo:function(a,c,b){b=3>arguments.length?!0:b;var g=c.getId(),l=c.attr("layout"),
d=Math.max(0,Math.min(c.attr("activeBufferIndex")+c.attr("numMoved"),c.bufferLength()-1)),d=c.getPosition(d);g.match(/^zn-pages-container/)?"row"===l?this.slideY(a,d.height,b):this.slideX(a,d.width,b):"row"===l?this.slideX(a,d.width,b):this.slideY(a,d.height,b)},slideX:function(a,c,b){!1===b?a.removeClass("zn-animate").addClass("zn-noanimate"):a.removeClass("zn-noanimate").addClass("zn-animate");a.css(this.whichTransformCSS(),"translateX("+c+"px)")},slideY:function(a,c,b){!1===b?a.removeClass("zn-animate").addClass("zn-noanimate"):
a.removeClass("zn-noanimate").addClass("zn-animate");a.css(this.whichTransformCSS(),"translateY("+c+"px)")},whichTransitionEvent:function(){var a=document.createElement("fakeelement"),c={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",MSTransition:"mstransitionend",WebkitTransition:"webkitTransitionEnd"},b;for(b in c)if(c.hasOwnProperty(b)&&void 0!==a.style[b])return c[b]},whichTransformCSS:function(){var a=document.createElement("fakeelement"),c={transform:"transform",
oTransform:"-o-transform",mozTransform:"-moz-transform",webkitTransform:"-webkit-transform",msTransform:"-ms-transform"},b;for(b in c)if(c.hasOwnProperty(b)&&void 0!==a.style[b])return c[b]}}}]);
app.factory("znSwipe",[function(){function a(a){var b=a.touches&&a.touches.length?a.touches:[a];a=a.changedTouches&&a.changedTouches[0]||a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]||b[0].originalEvent||b[0];return{x:a.clientX,y:a.clientY}}return{bind:function(c,b){var g,l,d,f,h=!1;c.bind("touchstart mousedown",function(c){d=a(c);h=!0;l=g=0;f=d;b.start&&b.start(d)});c.bind("touchcancel",function(a){h=!1;b.cancel&&b.cancel()});c.bind("touchmove mousemove",function(c){if(h&&
d){var m=a(c);g+=Math.abs(m.x-f.x);l+=Math.abs(m.y-f.y);f=m;10>g&&10>l||(c.preventDefault(),b.move&&b.move(m))}});c.bind("touchend mouseup",function(c){h&&(h=!1,b.end&&b.end(a(c)))})}}}]);
